<div>
    <div style="background: #FFF;">
        <div class="container-fluid">
            <div class="manage account-manage info-center">
                <div class="page-header">
                    <div class="pull-left">
                        <h4>产品管理</h4>
                    </div>
                </div>
                <form id="updateProduct">
                    <dl class="account-basic clearfix">
                        <dd class="pull-left margin-large-left margin-small-top">
                            <p class="text-small"><input type="hidden" id="id" name="id" style="width:250px"/>
                                <span class="show pull-left base-name">产品名称</span>
                                <span class="margin-left"><input type="text" id="name" name="name" style="width:250px"/></span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">起始额度</span>
                                <span class="margin-left"><input type="text" id="startAmount"
                                                                 onkeyup='this.value=this.value.replace(/\D/gi,"")'
                                                                 name="startAmount" style="width:250px"/>（元）</span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">截止额度</span>
                                <span class="margin-left"><input type="text" id="endAmount"
                                                                 onkeyup='this.value=this.value.replace(/\D/gi,"")'
                                                                 name="endAmount" style="width:250px"/>（元）</span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">期限类型</span>
                                <span class="margin-left">
                                    <input type="radio" name="periodType" value="day"/>天
                                    <input type="radio" name="periodType" value="month" checked="checked"/>月
                                </span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">起始期限</span>
                                <span class="margin-left"><input type="text" id="startPeriod"
                                                                 onkeyup='this.value=this.value.replace(/\D/gi,"")'
                                                                 name="startPeriod" style="width:250px"/></span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">截止期限</span>
                                <span class="margin-left"><input type="text" id="endPeriod"
                                                                 onkeyup='this.value=this.value.replace(/\D/gi,"")'
                                                                 name="endPeriod" style="width:250px"/></span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">列表图片</span>
                                <span class="margin-left">
                                        <input id="listFileHide" type="hidden" value="" name="img"
                                               style="width:250px;top:50px"/>
                                        <label for="listFile"><img id="listFileImg" src="img/upload.png" name="img"
                                                                   style="width:114px;height:114px"/></label>
                                        <input id="listFile" type="file" name="file"
                                               onchange="javascript:productImgUpload(this)" style="display: none"/>
                                </span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">推荐图片</span>
                                <span class="margin-left">
                                        <input id="recommendFileHide" type="hidden" value="" name="recommendImg"
                                               style="width:250px;top:50px"/>
                                        <label for="recommendFile"><img id="recommendFileImg" src="img/upload.png"
                                                                        style="width:114px;height:114px"/></label>
                                        <input id="recommendFile" type="file" name="file"
                                               onchange="productImgUpload(this)" style="display: none"/>
                                </span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">申请条件</span>
                                <span class="margin-left"><textarea cols="50" rows="5" name="applyCondition"
                                                                    id="applyCondition"></textarea></span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">申请流程</span>
                                <span class="margin-left"><textarea cols="50" rows="5" name="applyFlow"
                                                                    id="applyFlow"></textarea></span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">是否新产品</span>
                                <span class="margin-left">
                                        <select id="productType" name="productType">
                                             <option value="xkz">新口子</option>
                                             <option value="">老商户</option>
                                         </select>
                                    </span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">产品特性</span>
                                <span class="margin-left">
                                        <select id="isRecommend" name="isRecommend">
                                             <option value="0">默认</option>
                                             <option value="1">热门推荐</option>
                                             <option value="2">精品推荐</option>
                                             <option value="3">最新口子</option>
                                         </select>
                                    </span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">产品类型</span>
                                <span class="margin-left">
                                        <select id="sourceType" name="sourceType">
                                             <option value="salaryloan">工薪贷</option>
                                             <option value="xiaoejishuloan">小额极速借款</option>
                                             <option value="diyaloan">抵押贷款</option>
                                             <option value="creditcardloan">信用贷款</option>
                                         </select>
                                    </span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">后台地址</span>
                                <span class="margin-left"><input type="text" id="backendLoginUrl" name="backendLoginUrl"
                                                                 style="width:250px"/></span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">用户名</span>
                                <span class="margin-left"><input type="text" id="loginUser" name="loginUser"
                                                                 style="width:250px"/></span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">密码</span>
                                <span class="margin-left"><input type="text" id="loginPwd" name="loginPwd"
                                                                 style="width:250px"/></span>
                            </p>
                        </dd>
                        <dd class="pull-left margin-large-left margin-small-top">
                            <p class="text-small">
                                <span class="show pull-left base-name">利率</span>
                                <span class="margin-left"><input type="text" id="serviceRate"
                                                                 onkeyup="value=value.replace(/[^\d.]/g,'')"
                                                                 name="serviceRate" style="width:250px"/>(%)</span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">利率说明</span>
                                <span class="margin-left"><input type="text" id="rateMemo" name="rateMemo"
                                                                 style="width:250px"/></span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">放款天数</span>
                                <span class="margin-left"><input type="text" id="loanDay"
                                                                 onkeyup='this.value=this.value.replace(/\D/gi,"")'
                                                                 name="loanDay" style="width:250px"/>（天）</span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">来源渠道</span>
                                <span class="margin-left"><input type="text" name="channel" id="channel"
                                                                 style="width:250px"/></span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">H5Url</span>
                                <span class="margin-left"><input type="text" name="url" id="url"
                                                                 style="width:250px"/></span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">详情图片</span>
                                <input id="detailFileHide" type="hidden" value="" name="detailImg"
                                       style="width:250px;top:50px"/>
                                <label for="detailFile"><img id="detailFileImg" src="img/upload.png"
                                                             style="width:114px;height:114px"/></label>
                                <span class="margin-left">
                                         <form id="detailForm">
                                            <input id="detailFile" type="file" name="file"
                                                   onchange="javascript:productImgUpload(this)" style="display: none"/>
                                         </form>
                                    </span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">所需材料</span>
                                <span class="margin-left"><textarea cols="50" rows="5" id="applyMaterial"
                                                                    name="applyMaterial"></textarea></span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">投放渠道</span>
                                <span class="margin-left">
                                          <input type="checkbox" id="appleFlag" name="appleFlag" value="true"/>苹果&nbsp;&nbsp;
                                          <input type="checkbox" id="androidFlag" name="androidFlag" value="true"/>安卓&nbsp;&nbsp;
                                          <input type="checkbox" id="wechatFlag" name="wechatFlag" value="true"/>微信端
                                     </span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">所属app</span>
                                <span class="margin-left">
                                         <a href="javascript:void(0)" onclick="checkBelongApp()"><font
                                                 color="red">全选</font></a>
                                         <span id="appList"></span>
                                         </span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">合作模式</span>
                                <span class="margin-left">
                                         <select id="cooperationModel" name="cooperationModel">
                                             <option value="UV">UV</option>
                                             <option value="CPA">CPA</option>
                                             <option value="CPS">CPS</option>
                                             <option value="CPA+CPS">CPA+CPS</option>
                                         </select>
                                     </span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">合作价格</span>
                                <span class="margin-left"><textarea cols="50" rows="5" id="unitPrice"
                                                                    name="unitPrice"></textarea></span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">下载APP</span>
                                <span class="margin-left" style="height:50px">
                                          <input type="radio" name="isDownloadApp" value="true"/>是&nbsp;&nbsp;
                                          <input type="radio" name="isDownloadApp" value="false"/>否&nbsp;&nbsp;
                                     </span>
                            </p>
                        </dd>
                        <dd class="pull-left margin-large-left margin-small-top">
                            <p class="text-small">
                                <span class="show pull-left base-name">产品描述</span>
                                <span class="margin-left"><textarea cols="50" rows="5" name="productDesc"
                                                                    id="productDesc"></textarea></span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">产品标签(以分号[;]分割)</span>
                                <span class="margin-left"><textarea cols="50" rows="5" id="productLabel"
                                                                    name="productLabel"></textarea></span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">结算方式</span>
                                <span class="margin-left">
                                         <span class="margin-left">
                                             <input type="radio" name="settleCycle" value="1"/>日结&nbsp;&nbsp;
                                             <input type="radio" name="settleCycle" value="2"/>周结&nbsp;&nbsp;
                                             <input type="radio" name="settleCycle" value="3"/>月结&nbsp;&nbsp;
                                             <input type="radio" name="settleCycle" value="4"/>预付&nbsp;&nbsp;
                                             <input type="radio" name="settleCycle" value="5"/>担保&nbsp;&nbsp;
                                         </span>
                                     </span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">发票抬头</span>
                                <span class="margin-left">
                                         <span class="margin-left"><input type="text" id="accountName"
                                                                          name="accountName"
                                                                          style="width:250px"/></span>
                                     </span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">开户银行</span>
                                <span class="margin-left">
                                         <span class="margin-left"><input type="text" id="openBankName"
                                                                          name="openBankName"
                                                                          style="width:250px"/></span>
                                     </span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">银行账号</span>
                                <span class="margin-left">
                                         <span class="margin-left"><input type="text" id="bankAccount"
                                                                          name="bankAccount"
                                                                          style="width:250px"/></span>
                                     </span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">公司地址</span>
                                <span class="margin-left">
                                         <span class="margin-left"><input type="text" id="linkAddress"
                                                                          name="linkAddress"
                                                                          style="width:250px"/></span>
                                     </span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">公司电话</span>
                                <span class="margin-left">
                                         <span class="margin-left"><input type="text" id="linkPhone" name="linkPhone"
                                                                          style="width:250px"/></span>
                                     </span>
                            </p>

                            <p class="text-small">
                                <span class="show pull-left base-name">识别号</span>
                                <span class="margin-left">
                                         <span class="margin-left"><input type="text" id="taxpayerNo" name="taxpayerNo"
                                                                          style="width:250px"/></span>
                                     </span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">邮寄地址</span>
                                <span class="margin-left">
                                         <span class="margin-left"><input type="text" id="invoiceLinkAddress"
                                                                          name="invoiceLinkAddress"
                                                                          style="width:250px"/></span>
                                     </span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">收件电话</span>
                                <span class="margin-left">
                                         <span class="margin-left"><input type="text" id="invoiceLinkPhone"
                                                                          name="invoiceLinkPhone" style="width:250px"/></span>
                                     </span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">发票类型</span>
                                <span class="margin-left">
                                         <input type="radio" name="invoiceType" value="1"/>专票&nbsp;&nbsp;
                                         <input type="radio" name="invoiceType" value="0"/>普票&nbsp;&nbsp;
                                     </span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">开票名目</span>
                                <span class="margin-left">
                                         <span class="margin-left"><input type="text" id="invoiceItem"
                                                                          name="invoiceItem"
                                                                          style="width:250px"/></span>
                                     </span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">税金支付方</span>
                                <span class="margin-left">
                                         <span class="margin-left">
                                              <input type="radio" name="taxesObject" value="1"/>收款方&nbsp;&nbsp;
                                              <input type="radio" name="taxesObject" value="0"/>支付方&nbsp;&nbsp;
                                         </span>
                                     </span>
                            </p>
                            <p class="text-small">
                                <span class="show pull-left base-name">开票备注</span>
                                <span class="margin-left">
                                         <span class="margin-left">
                                             <textarea cols="50" rows="5" id="invoiceMemo"
                                                       name="invoiceMemo"></textarea>
                                         </span>
                                     </span>
                            </p>
                        </dd>
                    </dl>
                    <dd class="pull-left margin-large-left margin-small-top">
                        <p class="text-small">
                            <input type="button" value="保存" style="width: 150px;" onclick="javascript:saveProduct()"/>
                            <input type="button" value="返回" style="width: 150px;"
                                   onclick="javascript:backProductList()"/>
                        </p>
                    </dd>
                </form>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    function findByData() {
        var hrefUrl = window.location.href;
        var id = window.productId;
        var param = "id=" + id;
        var result = get(findByIdUrl, param);
        if (result.success) {
            $("#id").val(result.data.id);
            $("#name").val(result.data.name);
            $("#startAmount").val(result.data.startAmount);
            $("#endAmount").val(result.data.endAmount);
            $("#startPeriod").val(result.data.startPeriod);
            $("#endPeriod").val(result.data.endPeriod);
            $("#applyCondition").val(result.data.applyCondition);
            $("#applyFlow").val(result.data.applyFlow);
            $("#productDesc").text(result.data.productDesc);
            $("#productLabel").text(result.data.productLabel);
            $("input[name='periodType'][value='" + result.data.periodType + "']").attr("checked", true);
            $("input[name='isDownloadApp'][value='" + result.data.isDownloadApp + "']").attr("checked", true);

            if (result.data.appleFlag) {
                $("#appleFlag").attr("checked", true);
            }
            if (result.data.androidFlag) {
                $("#androidFlag").attr("checked", true);
            }
            if (result.data.wechatFlag) {
                $("#wechatFlag").attr("checked", true);
            }
            $("#detailFileImg").attr("src", result.data.detailImg);
            $("#detailFileHide").val(result.data.detailImg);

            $("#recommendFileImg").attr("src", result.data.recommendImg);
            $("#recommendFileHide").val(result.data.recommendImg);

            $("#listFileImg").attr("src", result.data.img);
            $("#listFileHide").val(result.data.img);

            $("#detailImg").attr("src", result.data.detailImg);
            $("#serviceRate").val(result.data.serviceRate);
            $("#rateMemo").val(result.data.rateMemo);
            $("#loanDay").val(result.data.loanDay);
            $("#channel").val(result.data.channel);
            $("#applyMaterial").val(result.data.applyMaterial);
            $("#url").val(result.data.url);
            $("#backendLoginUrl").val(result.data.backendLoginUrl);
            $("#loginUser").val(result.data.loginUser);
            $("#loginPwd").val(result.data.loginPwd);
            $("#unitPrice").val(result.data.unitPrice);
            $("#cooperationModel").val(result.data.cooperationModel);
            $("#productType").val(result.data.productType);
            $("#isRecommend").val(result.data.isRecommend);
            $("#sourceType").val(result.data.sourceType);

            $("#accountName").val(result.data.accountName);
            $("#openBankName").val(result.data.openBankName);
            $("#bankAccount").val(result.data.bankAccount);
            $("#linkAddress").val(result.data.linkAddress);
            $("#linkPhone").val(result.data.linkPhone);

            $("#taxpayerNo").val(result.data.taxpayerNo);
            $("#invoiceLinkAddress").val(result.data.invoiceLinkAddress);
            $("#invoiceLinkPhone").val(result.data.invoiceLinkPhone);
            $("#invoiceMemo").text(result.data.invoiceMemo == null ? "" : result.data.invoiceMemo);

            $("input[name='taxesObject'][value='" + result.data.taxesObject + "']").attr("checked", true);
            $("input[name='invoiceType'][value='" + result.data.invoiceType + "']").attr("checked", true);
            $("input[name='settleCycle'][value='" + result.data.settleCycle + "']").attr("checked", true);
            $("#invoiceItem").val(result.data.invoiceItem);

            var belongApp = result.data.belongApp.split(",");
            for (var i = 0; i < belongApp.length; i++) {
                $("input[name='belongApp'][value='" + belongApp[i] + "']").attr("checked", true);
            }
        } else {
            showTipMessage(result.message, true);
        }
    }

    //图片上传
    function productImgUpload(obj) {
        var objId = obj.id;
        var fileId = objId.replace("Upload", "");
        uploadFile(fileId);
    }

    //保存产品
    function saveProduct() {
        var data = $("#updateProduct").serializeArray();
        var values = {};
        for (var item in data) {
            if (values[data[item].name] != null || values[data[item].name] != undefined) {
                values[data[item].name] = values[data[item].name] + "," + data[item].value.trim();
            } else {
                values[data[item].name] = data[item].value.trim();
            }

        }
        if ($("#name").val() == undefined || $("#img").val() == '') {
            showTipMessage("请填写产品名称", false);
            return false;
        }
        if ($("#listFileHide").val() == undefined || $("#listFileHide").val() == '') {
            showTipMessage("请上传产品列表图片", false);
            return false;
        }
        if ($("#detailFileHide").val() == undefined || $("#detailFileHide").val() == '') {
            showTipMessage("请上传产品详情图片", false);
            return false;
        }
        var result = post(updateUrl, values);
        if (result.success) {
            cwLoad("product/productlist.html");
        } else {
            showTipMessage(result.message, true);
        }
    }

    function setShowOrder() {
        var textOrderSql = $("#allSeq").val();
        if (textOrderSql == undefined || textOrderSql == "") {
            showTipMessage("请设置排序号", false);
        } else {
            $.each($("input:text"), function (i, val) {
                var name = val.name;
                if (name.indexOf("showOrder") != -1) {
                    val.value = textOrderSql;
                }
            });
        }
    }

    $(function () {
        var param = "type=bannerPosition";
        var result = get(appUrl,param);
        var resultData = result.data;
        var sTrHtml = "";
        $.each(resultData, function (j) {
            sTrHtml += "<input type=\"checkbox\" name=\"belongApp\" value=\""+resultData[j].code+"\"/>";
            sTrHtml += resultData[j].name+"&nbsp;&nbsp;";
            if(j%4==0){
                sTrHtml += "<br>";
            }
        });
        $("#appList").append(sTrHtml);
        findByData();
    });
</script>
